# Gate.io Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Gate.io –¥–ª—è —Å–±–æ—Ä–∞ 1-—Å–µ–∫—É–Ω–¥–Ω—ã—Ö —Å–≤–µ—á–µ–π —Å Spot –∏ Linear (Futures) —Ä—ã–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ –ø–æ—Ç–æ–∫–∏ —Å–¥–µ–ª–æ–∫.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å:
```bash
python main.py
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `config.py`:
```python
config.exchanges.gate_spot = True    # Spot —Ä—ã–Ω–æ–∫
config.exchanges.gate_linear = True  # Futures —Ä—ã–Ω–æ–∫
```

## üîå WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### Endpoints
- **Spot**: `wss://api.gateio.ws/ws/v4/`
- **Linear**: `wss://fx-ws.gateio.ws/v4/ws/usdt`
- **–í–µ—Ä—Å–∏—è API**: v4
- **–°–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `websockets.connect()`
- **–§—É–Ω–∫—Ü–∏—è**: `_ws_connection_worker()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–æ–¥–µ
- **Heartbeat**: –û—Ç–∫–ª—é—á—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (`ping_interval=None`, `ping_timeout=None`)
- **Close timeout**: 10 —Å–µ–∫—É–Ω–¥ (`close_timeout=10`)
- **Message timeout**: 120 —Å–µ–∫—É–Ω–¥ (—Ç–∞–π–º–∞—É—Ç –≤ `asyncio.wait_for()`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏**: 1 —Å–µ–∫—É–Ω–¥–∞ (`DELAY_BETWEEN_WS = 1`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏**: 0.5 —Å–µ–∫—É–Ω–¥—ã (`DELAY_BETWEEN_SUBSCRIBE = 0.5`)
- **Heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª**: 30 —Å–µ–∫—É–Ω–¥ (`HEARTBEAT_INTERVAL = 30`)

### Ping/Pong –º–µ—Ö–∞–Ω–∏–∑–º

Gate.io –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ä—É—á–Ω–æ–π JSON heartbeat** —á–µ—Ä–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∫–∞–Ω–∞–ª–æ–≤:
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: 30 —Å–µ–∫—É–Ω–¥ (`HEARTBEAT_INTERVAL = 30`)
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –û—Ç–¥–µ–ª—å–Ω–∞—è asyncio –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–∞–Ω–∞–ª–æ–º ping
- **–§–æ—Ä–º–∞—Ç**: JSON —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª—è–º–∏ `time` –∏ `channel`

**–§–æ—Ä–º–∞—Ç ping —Å–æ–æ–±—â–µ–Ω–∏—è**:
```python
ping_msg = {
    "time": int(time.time()),
    "channel": "spot.ping"  # –∏–ª–∏ "futures.ping" –¥–ª—è Linear
}
await websocket.send(json.dumps(ping_msg))
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ pong –æ—Ç–≤–µ—Ç–∞**:
```python
if message_dict.get("channel") in ["spot.pong", "futures.pong"]:
    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º pong
```

**–ö–æ–¥ heartbeat**:
```python
async def ping_loop():
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π ping —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    ping_msg = {
        "time": int(time.time()),
        "channel": ping_channel,  # "spot.ping" –∏–ª–∏ "futures.ping"
    }
    await websocket.send(json.dumps(ping_msg))
    
    # –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º ping –∫–∞–∂–¥—ã–µ HEARTBEAT_INTERVAL —Å–µ–∫—É–Ω–¥
    while True:
        await asyncio.sleep(HEARTBEAT_INTERVAL)  # 30 —Å–µ–∫—É–Ω–¥
        ping_msg = {
            "time": int(time.time()),
            "channel": ping_channel,
        }
        await websocket.send(json.dumps(ping_msg))

ping_task = asyncio.create_task(ping_loop())
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- Ping –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ó–∞—Ç–µ–º ping –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
- –ö–∞–Ω–∞–ª ping –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä—ã–Ω–∫–∞: `spot.ping` –¥–ª—è Spot, `futures.ping` –¥–ª—è Linear

## ‚öôÔ∏è –õ–∏–º–∏—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã

#### –õ–∏–º–∏—Ç—ã –≤ –∫–æ–¥–µ

**Spot —Ä—ã–Ω–æ–∫**:
- **–°–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: **135 –ø–∞—Ä** (`SPOT_SYMBOLS_PER_CONNECTION = 135`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏**: **1 —Å–µ–∫—É–Ω–¥–∞** (`DELAY_BETWEEN_WS = 1`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏**: **0.5 —Å–µ–∫—É–Ω–¥—ã** (`DELAY_BETWEEN_SUBSCRIBE = 0.5`)

**Futures (Linear) —Ä—ã–Ω–æ–∫**:
- **–°–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: **100 –ø–∞—Ä** (`LINEAR_SYMBOLS_PER_CONNECTION = 100`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏**: **1 —Å–µ–∫—É–Ω–¥–∞** (`DELAY_BETWEEN_WS = 1`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏**: **0.5 —Å–µ–∫—É–Ω–¥—ã** (`DELAY_BETWEEN_SUBSCRIBE = 0.5`)

**–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- **Heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª**: **30 —Å–µ–∫—É–Ω–¥** (`HEARTBEAT_INTERVAL = 30`)
- **Message timeout**: **120 —Å–µ–∫—É–Ω–¥** (–≤ `asyncio.wait_for()`)
- **–ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞**: **5 —Å–µ–∫—É–Ω–¥** (`RECONNECT_DELAY = 5`)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞**: **300 —Å–µ–∫—É–Ω–¥** (`MAX_RECONNECT_DELAY = 300`)

#### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã Gate.io
- **–ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**: **300 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ IP –∞–¥—Ä–µ—Å**
- **–†–µ–π—Ç-–ª–∏–º–∏—Ç**: ~50 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ –Ω–∞ –∫–∞–Ω–∞–ª (–Ω–µ–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ 0.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ª–∏–º–∏—Ç–∞–º

‚ö†Ô∏è **–í–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å**:
- **–ù–µ –ø—Ä–µ–≤—ã—à–∞–π—Ç–µ 300 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ IP** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–°–æ–±–ª—é–¥–∞–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É 0.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏** - –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ä–µ–π—Ç-–ª–∏–º–∏—Ç–æ–≤
- **–°–æ–±–ª—é–¥–∞–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫—É 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏** - –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
- **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```python
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
num_connections_spot = ceil(total_symbols_spot / 135)
num_connections_linear = ceil(total_symbols_linear / 100)
```

**–ü—Ä–∏–º–µ—Ä**:
- 400 —Å–∏–º–≤–æ–ª–æ–≤ Spot ‚Üí 3 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (135 + 135 + 130)
- 250 —Å–∏–º–≤–æ–ª–æ–≤ Linear ‚Üí 3 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (100 + 100 + 50)

**–ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏**:
```python
await asyncio.sleep(DELAY_BETWEEN_WS)  # 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
```

## üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–µ—á–µ–π

### –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
Gate.io **–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Å–≤–µ—á–∏** - –æ–Ω–∏ —Å—Ç—Ä–æ—è—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–æ–≤ —Å–¥–µ–ª–æ–∫ (trades) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `CandleBuilder`:
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏–∑ WebSocket –ø–æ—Ç–æ–∫–∞
2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –≤ 1-—Å–µ–∫—É–Ω–¥–Ω—ã–µ —Å–≤–µ—á–∏
3. –í–æ–∑–≤—Ä–∞—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å–≤–µ—á–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—É—é —Å–µ–∫—É–Ω–¥—É

## üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- **–ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: 5 —Å–µ–∫—É–Ω–¥ (`RECONNECT_DELAY = 5`)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: 300 —Å–µ–∫—É–Ω–¥ (`MAX_RECONNECT_DELAY = 300`)
- **Backoff –º–Ω–æ–∂–∏—Ç–µ–ª—å**: 2 (`BACKOFF_MULTIPLIER = 2`)
- **–°–ª—É—á–∞–π–Ω–∞—è –¥–æ–±–∞–≤–∫–∞**: 0-5 —Å–µ–∫—É–Ω–¥ (—Å–ª—É—á–∞–π–Ω–∞—è –¥–æ–±–∞–≤–∫–∞ –∫ –∑–∞–¥–µ—Ä–∂–∫–µ)
- **–°—á—ë—Ç—á–∏–∫**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ (`_stats[market]["reconnects"]`)

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞**:
```python
reconnect_attempt += 1
is_reconnect = reconnect_attempt > 1

if is_reconnect:
    _stats[market]["reconnects"] += 1
    await on_error({
        "exchange": "gate",
        "market": market,
        "connection_id": connection_id,
        "type": "reconnect",
    })
    await asyncio.sleep(reconnect_delay)
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —Å backoff
    reconnect_delay = min(
        reconnect_delay * BACKOFF_MULTIPLIER + random.uniform(0, 5),
        MAX_RECONNECT_DELAY
    )
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- **–ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞**: 5 —Å–µ–∫—É–Ω–¥
- **–í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞**: 5 * 2 + (0-5) = 10-15 —Å–µ–∫—É–Ω–¥
- **–¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞**: 15 * 2 + (0-5) = 30-35 —Å–µ–∫—É–Ω–¥
- **–ò —Ç–∞–∫ –¥–∞–ª–µ–µ**, –Ω–æ –Ω–µ –±–æ–ª–µ–µ 300 —Å–µ–∫—É–Ω–¥

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
- –ü—Ä–∏ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è callback `on_error()` —Å —Ç–∏–ø–æ–º "reconnect"
- Ping –∑–∞–¥–∞—á–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `logger.error()`
- –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –¥–æ —è–≤–Ω–æ–π –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

#### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π
Gate.io –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç v4 WebSocket API:

#### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª

**–§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∫–∏**:
```json
{
  "time": 1640000000,
  "channel": "spot.trades",
  "event": "subscribe",
  "payload": ["BTC_USDT"]
}
```

**–ö–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏**:
```python
# –î–ª—è Spot
subscribe_msg = {
    "time": int(time.time()),
    "channel": "spot.trades",
    "event": "subscribe",
    "payload": [symbol],  # –ü–æ –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É –∑–∞ —Ä–∞–∑
}

# –î–ª—è Linear
subscribe_msg = {
    "time": int(time.time()),
    "channel": "futures.trades",
    "event": "subscribe",
    "payload": [symbol],
}

await websocket.send(json.dumps(subscribe_msg))
```

**–ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–ø–∏—Å–∫–∏**:
1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. **–ó–∞–ø—É—Å–∫ ping**: –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ ping
3. **–ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
4. **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏**: 0.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ (`DELAY_BETWEEN_SUBSCRIBE = 0.5`)

**–ö–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ —Å–∏–º–≤–æ–ª–∞–º**:
```python
for i, symbol in enumerate(symbols):
    if market == "spot":
        subscribe_msg = {
            "time": int(time.time()),
            "channel": "spot.trades",
            "event": "subscribe",
            "payload": [symbol],
        }
    else:
        subscribe_msg = {
            "time": int(time.time()),
            "channel": "futures.trades",
            "event": "subscribe",
            "payload": [symbol],
        }
    
    await websocket.send(json.dumps(subscribe_msg))
    
    # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
    if i < len(symbols) - 1:
        await asyncio.sleep(DELAY_BETWEEN_SUBSCRIBE)  # 0.5 —Å–µ–∫—É–Ω–¥—ã
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É –∑–∞ —Ä–∞–∑
- –ó–∞–¥–µ—Ä–∂–∫–∞ 0.5 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ä–µ–π—Ç-–ª–∏–º–∏—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è Spot –∏ Linear

#### –ö–∞–Ω–∞–ª—ã

- **Spot**: 
  - Trades: `spot.trades`
  - Ping/Pong: `spot.ping` / `spot.pong`
  
- **Futures (Linear)**: 
  - Trades: `futures.trades`
  - Ping/Pong: `futures.ping` / `futures.pong`

### –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –∫–∞–Ω–∞–ª–æ–≤

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –Ø–≤–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ **–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**

**–ü—Ä–∏—á–∏–Ω–∞**:
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `task.cancel()` –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º**:
```python
unsubscribe_msg = {
    "time": int(time.time()),
    "channel": "spot.trades",
    "event": "unsubscribe",
    "payload": ["BTC_USDT"]
}
await websocket.send(json.dumps(unsubscribe_msg))
```

### –§–æ—Ä–º–∞—Ç —Å–¥–µ–ª–æ–∫

#### Spot
```json
{
  "time": 1640000000,
  "channel": "spot.trades",
  "event": "update",
  "result": {
    "currency_pair": "BTC_USDT",
    "create_time_ms": "1640000000000",
    "price": "50000",
    "amount": "0.001"
  }
}
```

#### Linear (Futures)
```json
{
  "time": 1640000000,
  "channel": "futures.trades",
  "event": "update",
  "result": [
    {
      "contract": "BTC_USDT",
      "create_time_ms": "1640000000000",
      "price": "50000",
      "size": "100"
    }
  ]
}
```

## üîç –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤

### REST API Endpoints
- **Spot**: `https://api.gateio.ws/api/v4/spot/currency_pairs`
- **Linear**: `https://api.gateio.ws/api/v4/futures/usdt/contracts`

### –§–∏–ª—å—Ç—Ä—ã
- **Spot**: —Å—Ç–∞—Ç—É—Å `trade_status == "tradable"`
- **Linear**: —Å—Ç–∞—Ç—É—Å `status == "trading"`

## üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–≤–µ—á–∏ –∏–∑ —Å–¥–µ–ª–æ–∫
```python
candle = Candle(
    ts_ms=trade_timestamp,  # Timestamp —Å–¥–µ–ª–∫–∏
    open=first_trade_price,
    high=max_price,
    low=min_price,
    close=last_trade_price,
    volume=sum_of_quantities,  # –û–±—ä—ë–º –≤ –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç–µ
    market="spot" or "linear",
    exchange="gate",
    symbol="BTC_USDT"
)
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ç—Ä–µ–π–¥–æ–≤ –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ timestamp –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ size –¥–ª—è futures (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º)
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ pong —Å–æ–æ–±—â–µ–Ω–∏–π

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 5 —Å–µ–∫, –º–∞–∫—Å–∏–º—É–º 300 —Å–µ–∫)
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–π—Ç-–ª–∏–º–∏—Ç–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- Graceful degradation –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö

## üìù –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–†—É—á–Ω–æ–π ping**: –û—Ç–∫–ª—é—á—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ping, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JSON ping —Å–æ–æ–±—â–µ–Ω–∏—è
2. **Graceful shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ –∑–∞–¥–∞—á
3. **Memory efficient**: –°–≤–µ—á–∏ —Å—Ç—Ä–æ—è—Ç—Å—è –ø–æ—Ç–æ–∫–æ–≤–æ –±–µ–∑ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏
4. **Flexible formats**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–¥–µ–ª–æ–∫ –æ—Ç Gate.io
5. **Auto-scaling**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø–æ–¥ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Gate.io
- Gate.io –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç 300 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ IP –∞–¥—Ä–µ—Å
- –°—Ç—Ä–æ–≥–∏–µ —Ä–µ–π—Ç-–ª–∏–º–∏—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏—è –∑–∞–¥–µ—Ä–∂–µ–∫
- –û—Ç–¥–µ–ª—å–Ω—ã–µ endpoints –¥–ª—è Spot –∏ Linear
- –ù–µ–æ–±—Ö–æ–¥–∏–º —Ä—É—á–Ω–æ–π JSON ping –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –°–æ–±–ª—é–¥–∞–π—Ç–µ –ª–∏–º–∏—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
- –ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```python
from exchanges.gate import ws_handler

stats = ws_handler.get_statistics()
print(f"Spot: {stats['spot']['active_connections']} connections, "
      f"{stats['spot']['active_symbols']} symbols, "
      f"{stats['spot']['reconnects']} reconnects")
```

### –õ–æ–≥–∏
–í—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
- Ping/pong —Å–æ–æ–±—â–µ–Ω–∏—è

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Gate.io WebSocket API Docs](https://www.gate.io/docs/developers/apiv4/ws/en/)
- [Gate.io REST API](https://www.gate.io/docs/developers/apiv4/)
- [Gate.io Trades Channel](https://www.gate.io/docs/developers/apiv4/ws/en/#spot-channels)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑—Ä—ã–≤–∞–º (Ctrl+C –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
2. –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–≤–µ—á–µ–π
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç—Å—è –ª–∏–º–∏—Ç—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–∏–º–≤–æ–ª–æ–≤

