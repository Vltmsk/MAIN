# Bitget Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Bitget –¥–ª—è —Å–±–æ—Ä–∞ 1-—Å–µ–∫—É–Ω–¥–Ω—ã—Ö —Å–≤–µ—á–µ–π —Å Spot –∏ Linear (Futures) —Ä—ã–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ –ø–æ—Ç–æ–∫–∏ —Å–¥–µ–ª–æ–∫.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å:
```bash
python main.py
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `config.py`:
```python
config.exchanges.bitget_spot = True    # Spot —Ä—ã–Ω–æ–∫
config.exchanges.bitget_linear = True  # Futures —Ä—ã–Ω–æ–∫
```

## üîå WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### Endpoint
- **URL**: `wss://ws.bitget.com/v2/ws/public`
- **–í–µ—Ä—Å–∏—è**: v2
- **–¢–∏–ø**: Public WebSocket (–±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- **–°–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `aiohttp.ClientSession.ws_connect()`
- **–§—É–Ω–∫—Ü–∏—è**: `_ws_batch_worker()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞—Ç—á–∞ —Å–∏–º–≤–æ–ª–æ–≤

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–æ–¥–µ
- **Heartbeat**: –û—Ç–∫–ª—é—á—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (`heartbeat=None`, `autoping=False`)
- **–¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: 30 —Å–µ–∫—É–Ω–¥
- **–¢–∞–π–º–∞—É—Ç –ø–æ–ª—É—á–µ–Ω–∏—è**: 120 —Å–µ–∫—É–Ω–¥ (`receive_timeout=PING_GRACE_SEC`)
- **–ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ**: –í–∫–ª—é—á–µ–Ω–æ (`autoclose=True`)
- **–ö–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è**: –ú–∞–∫—Å–∏–º—É–º **3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (`CONNECT_CONCURRENCY = 3`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏**: 5.0 ¬± 1.2 —Å–µ–∫—É–Ω–¥—ã (`WS_STAGGER_SEC = 5.0`, `WS_STAGGER_JITTER_SEC = 1.2`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–¥–ø–∏—Å–∫–æ–π**: 3.5 ¬± 1.0 —Å–µ–∫—É–Ω–¥—ã (`SUBSCRIBE_DELAY_PER_WS_SEC = 3.5`, `SUBSCRIBE_DELAY_JITTER_SEC = 1.0`)

### Ping/Pong –º–µ—Ö–∞–Ω–∏–∑–º

Bitget –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ä—É—á–Ω–æ–π heartbeat** —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: 30 —Å–µ–∫—É–Ω–¥ (`PING_INTERVAL_SEC = 30`)
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –û—Ç–¥–µ–ª—å–Ω–∞—è asyncio –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `"ping"`
- **Grace –ø–µ—Ä–∏–æ–¥**: 120 —Å–µ–∫—É–Ω–¥ (`PING_GRACE_SEC = 120`) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è pong
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ pong**: –ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `"pong"`

```python
async def heartbeat_loop():
    while True:
        await asyncio.sleep(PING_INTERVAL_SEC)  # 30 —Å–µ–∫—É–Ω–¥
        await ws.send_str("ping")  # –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ ping

heartbeat_task = asyncio.create_task(heartbeat_loop())
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ pong –æ—Ç–≤–µ—Ç–∞**:
```python
if msg.type == aiohttp.WSMsgType.TEXT:
    txt = msg.data
    if isinstance(txt, str) and txt.strip().lower() == "pong":
        continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º pong
```

**–¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è**:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `asyncio.wait_for(ws.receive(), timeout=PING_GRACE_SEC)` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ç–∞–π–º–∞—É—Ç–æ–≤
- –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ —Ü–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è (–Ω–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π)

## üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–µ—á–µ–π

### –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è
Bitget **–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ —Å–≤–µ—á–∏** - –æ–Ω–∏ —Å—Ç—Ä–æ—è—Ç—Å—è –∏–∑ –ø–æ—Ç–æ–∫–æ–≤ —Å–¥–µ–ª–æ–∫ (trades) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `CandleBuilder`:
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –∏–∑ WebSocket –ø–æ—Ç–æ–∫–∞
2. –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫ –≤ 1-—Å–µ–∫—É–Ω–¥–Ω—ã–µ —Å–≤–µ—á–∏
3. –í–æ–∑–≤—Ä–∞—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Å–≤–µ—á–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –Ω–æ–≤—É—é —Å–µ–∫—É–Ω–¥—É

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º
- –ü–æ–ª–µ `channel` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `trade`
- –ü–æ–ª–µ `instType` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `SPOT` –¥–ª—è spot –∏–ª–∏ `USDT-FUTURES` –¥–ª—è futures
- –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)

### –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
```json
{
  "arg": {
    "instType": "SPOT",
    "channel": "trade",
    "instId": "BTCUSDT"
  },
  "data": [
    {
      "px": "50000",
      "sz": "0.001",
      "ts": 1234567890000
    }
  ]
}
```

## ‚öôÔ∏è –õ–∏–º–∏—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã

#### –õ–∏–º–∏—Ç—ã –≤ –∫–æ–¥–µ

**Spot —Ä—ã–Ω–æ–∫**:
- **–°–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: **39 –ø–∞—Ä** (`BATCH_SIZE = 39`)
- **–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ**: **19 —Å–∏–º–≤–æ–ª–æ–≤** (`SUBSCRIBE_CHUNK_SIZE = 19`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏**: **0.30 —Å–µ–∫—É–Ω–¥—ã** (`SUBSCRIBE_CHUNK_PAUSE_SEC = 0.30`)

**Futures (Linear) —Ä—ã–Ω–æ–∫**:
- **–°–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: **100 –ø–∞—Ä** (`FUT_BATCH_SIZE = 100`)
- **–†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ**: **19 —Å–∏–º–≤–æ–ª–æ–≤** (`SUBSCRIBE_CHUNK_SIZE = 19`)
- **–ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏**: **0.30 —Å–µ–∫—É–Ω–¥—ã** (`SUBSCRIBE_CHUNK_PAUSE_SEC = 0.30`)

**–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- **–ú–∞–∫—Å–∏–º—É–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π**: **3** (`CONNECT_CONCURRENCY = 3`)
- **Ping –∏–Ω—Ç–µ—Ä–≤–∞–ª**: **30 —Å–µ–∫—É–Ω–¥** (`PING_INTERVAL_SEC = 30`)
- **Ping grace –ø–µ—Ä–∏–æ–¥**: **120 —Å–µ–∫—É–Ω–¥** (`PING_GRACE_SEC = 120`)

#### –†–µ–π—Ç-–ª–∏–º–∏—Ç—ã Bitget
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç**: –ù–µ —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ, –Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∂—ë—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ª–∏–º–∏—Ç–∞–º

‚ö†Ô∏è **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å**:
- **–ù–µ –ø—Ä–µ–≤—ã—à–∞–π—Ç–µ 3 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–º–∞—Ñ–æ—Ä –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è
- **–°–æ–±–ª—é–¥–∞–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏** - 5.0 ¬± 1.2 —Å–µ–∫—É–Ω–¥—ã —Å —Å–ª—É—á–∞–π–Ω–æ–π –¥–æ–±–∞–≤–∫–æ–π
- **–°–æ–±–ª—é–¥–∞–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏** - 0.30 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–º–∞—Ñ–æ—Ä –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–∞–Ω–∞–º

### –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–µ–º–∞—Ñ–æ—Ä**:
```python
semaphore = asyncio.Semaphore(CONNECT_CONCURRENCY)  # –ú–∞–∫—Å–∏–º—É–º 3

async def _create_connection_task(batch_id, symbols_batch, market):
    async with semaphore:  # –ë–ª–æ–∫–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ —É–∂–µ 3 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        task = asyncio.create_task(_ws_batch_worker(...))
        _tasks.append(task)
```

**–ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏**:
```python
# –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
stagger_delay = WS_STAGGER_SEC + random.uniform(0, WS_STAGGER_JITTER_SEC)
await asyncio.sleep(stagger_delay)  # 5.0 ¬± 1.2 —Å–µ–∫—É–Ω–¥—ã
```

## üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- **–ó–∞–¥–µ—Ä–∂–∫–∞**: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff –æ—Ç 2 –¥–æ 60 —Å–µ–∫—É–Ω–¥
- **–§–æ—Ä–º—É–ª–∞**: `min(2 ^ min(reconnect_attempt - 1, 5), 60)`
- **–°—á—ë—Ç—á–∏–∫**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ (`_stats[market]["reconnects"]`)
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞ —á–µ—Ä–µ–∑ callback `on_error()`

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞**:
```python
reconnect_attempt += 1
if reconnect_attempt > 1:
    delay = min(2 ** min(reconnect_attempt - 1, 5), 60)
    _stats[market]["reconnects"] += 1
    await on_error({
        "exchange": "bitget",
        "market": market,
        "connection_id": f"batch-{batch_id}",
        "type": "reconnect",
    })
    await asyncio.sleep(delay)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- **–ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞**: 2 —Å–µ–∫—É–Ω–¥—ã
- **–í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞**: 4 —Å–µ–∫—É–Ω–¥—ã
- **–¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞**: 8 —Å–µ–∫—É–Ω–¥
- **–ß–µ—Ç–≤—ë—Ä—Ç–∞—è –ø–æ–ø—ã—Ç–∫–∞**: 16 —Å–µ–∫—É–Ω–¥
- **–ü—è—Ç–∞—è –ø–æ–ø—ã—Ç–∫–∞**: 32 —Å–µ–∫—É–Ω–¥—ã
- **–î–∞–ª–µ–µ**: 60 —Å–µ–∫—É–Ω–¥ (–º–∞–∫—Å–∏–º—É–º)

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `logger.error()`
- –ü—Ä–∏ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è callback `on_error()` —Å —Ç–∏–ø–æ–º "reconnect"
- –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –¥–æ —è–≤–Ω–æ–π –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á–∏

## üì° –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª—ã

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏

#### –§–æ—Ä–º–∞—Ç –ø–æ–¥–ø–∏—Å–∫–∏
```json
{
  "op": "subscribe",
  "args": [
    {
      "instType": "SPOT",
      "channel": "trade",
      "instId": "BTCUSDT"
    },
    {
      "instType": "SPOT",
      "channel": "trade",
      "instId": "ETHUSDT"
    }
  ]
}
```

#### –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–ø–∏—Å–∫–∏

**–ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å**:
1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. **–ó–∞–¥–µ—Ä–∂–∫–∞**: –û–∂–∏–¥–∞–Ω–∏–µ 3.5 ¬± 1.0 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏
3. **–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏**: –°–∏–º–≤–æ–ª—ã —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ 19 —à—Ç—É–∫ (`SUBSCRIBE_CHUNK_SIZE = 19`)
4. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è JSON —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **–ü–∞—É–∑–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏**: 0.30 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (`SUBSCRIBE_CHUNK_PAUSE_SEC = 0.30`)

**–ö–æ–¥ –ø–æ–¥–ø–∏—Å–∫–∏**:
```python
# –†–∞–∑–±–∏–≤–∞–µ–º —Å–∏–º–≤–æ–ª—ã –Ω–∞ —á–∞–Ω–∫–∏
inst_type = "SPOT" if market == "spot" else "USDT-FUTURES"
for chunk_start in range(0, len(symbols), SUBSCRIBE_CHUNK_SIZE):
    chunk = symbols[chunk_start:chunk_start + SUBSCRIBE_CHUNK_SIZE]
    args = [{"instType": inst_type, "channel": "trade", "instId": s} for s in chunk]
    await ws.send_json({"op": "subscribe", "args": args})
    
    # –ü–∞—É–∑–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
    if chunk_start + SUBSCRIBE_CHUNK_SIZE < len(symbols):
        await asyncio.sleep(SUBSCRIBE_CHUNK_PAUSE_SEC)
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ —á–∞–Ω–∫–∞–º –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ä–µ–π—Ç-–ª–∏–º–∏—Ç–æ–≤
- –ó–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏–º–∏—Ç–∏—Ä—É—é—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª—É—á–∞–π–Ω—ã–µ –¥–æ–±–∞–≤–∫–∏ –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º

### –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –∫–∞–Ω–∞–ª–æ–≤

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –Ø–≤–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ **–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**

**–ü—Ä–∏—á–∏–Ω–∞**:
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `task.cancel()` –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º**:
```python
unsubscribe_msg = {
    "op": "unsubscribe",
    "args": [
        {"instType": "SPOT", "channel": "trade", "instId": "BTCUSDT"}
    ]
}
await ws.send_json(unsubscribe_msg)
```

## üîç –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤

### REST API Endpoints

#### Spot
- **URL**: `https://api.bitget.com/api/v2/spot/public/symbols`
- **–ú–µ—Ç–æ–¥**: GET
- **–§–∏–ª—å—Ç—Ä**: —Ç–æ–ª—å–∫–æ USDT –ø–∞—Ä—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `online`

#### Futures (Linear)
–ü—Ä–æ–±—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ endpoints –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
1. `https://api.bitget.com/api/v2/mix/market/tickers?productType=USDT-FUTURES`
2. `https://api.bitget.com/api/v2/mix/market/contracts?productType=USDT-FUTURES`
3. `https://api.bitget.com/api/mix/v1/market/contracts?productType=USDT-FUTURES`
4. `https://api.bitget.com/api/v2/mix/market/contracts?productType=UMCBL`
5. `https://api.bitget.com/api/mix/v1/market/contracts?productType=UMCBL`

**–§–∏–ª—å—Ç—Ä**: —Ç–æ–ª—å–∫–æ USDT –ø–∞—Ä—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `online`, `normal` –∏–ª–∏ `trading`

## üõ†Ô∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Trade —Å–æ–æ–±—â–µ–Ω–∏–µ
```python
{
  "px": float,      # –¶–µ–Ω–∞ —Å–¥–µ–ª–∫–∏
  "sz": float,      # –†–∞–∑–º–µ—Ä —Å–¥–µ–ª–∫–∏ (–≤ –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç–µ)
  "ts": int         # Timestamp –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
}
```

### –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–≤–µ—á–∏
```python
candle = Candle(
    ts_ms=trade_ts // 1000 * 1000,  # –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ –Ω–∞—á–∞–ª–∞ —Å–µ–∫—É–Ω–¥—ã
    open=first_trade_price,
    high=max_price,
    low=min_price,
    close=last_trade_price,
    volume=sum_of_quantities,  # –û–±—ä—ë–º –≤ –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç–µ
    market="spot" or "linear",
    exchange="bitget",
    symbol="BTCUSDT"
)
```

## üìù –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è (—Å–æ–¥–µ—Ä–∂–∏—Ç –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
2. **Safe parsing**: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ NaN
3. **Concurrency control**: —Å–µ–º–∞—Ñ–æ—Ä –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
4. **Staggered connections**: —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏–º–∏—Ç–∏—Ä—É—é—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
5. **Graceful degradation**: –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–ª–∞–≤–Ω—ã–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∑–∞–¥–∞—á

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Bitget
- Bitget –∏–º–µ–µ—Ç —Å—Ç—Ä–æ–≥–∏–µ —Ä–µ–π—Ç-–ª–∏–º–∏—Ç—ã –∏ –º–æ–∂–µ—Ç –±–∞–Ω–∏—Ç—å –ø—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–µ –º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í—Å–µ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É
- –¢–∞–π–º–∞—É—Ç—ã –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –æ—à–∏–±–∫–∞–º–∏ (continuing loop)
- –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
```python
from exchanges.bitget import ws_handler

stats = ws_handler.get_statistics()
print(f"Spot: {stats['spot']['active_connections']} connections, "
      f"{stats['spot']['active_symbols']} symbols, "
      f"{stats['spot']['reconnects']} reconnects")
```

### –õ–æ–≥–∏
–í—Å–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –∏ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Bitget WebSocket API Docs](https://www.bitget.com/api-doc/contract/websocket/public/Trades-Channel)
- [Bitget REST API](https://www.bitget.com/api-doc/contract/websocket/public/Public-Instrument)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å–∏–º–≤–æ–ª–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Ä–∞–∑—Ä—ã–≤–∞–º (Ctrl+C –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
3. –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–≤–µ—á–µ–π

