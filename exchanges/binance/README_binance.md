# Binance Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Binance –¥–ª—è —Å–±–æ—Ä–∞ 1-—Å–µ–∫—É–Ω–¥–Ω—ã—Ö —Å–≤–µ—á–µ–π —Å Spot –∏ Linear (USD‚ìà-M Futures) —Ä—ã–Ω–∫–æ–≤.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å:
```bash
python main.py
```

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `config.py`:
```python
config.exchanges.binance_spot = True    # Spot —Ä—ã–Ω–æ–∫
config.exchanges.binance_linear = True  # Futures —Ä—ã–Ω–æ–∫
```

## üîå WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### Spot –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **Endpoint**: `wss://stream.binance.com:9443/stream`
- **–§–æ—Ä–º–∞—Ç**: –ú—É–ª—å—Ç–∏-—Å—Ç—Ä–∏–º (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –æ–¥–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- **URL –ø—Ä–∏–º–µ—Ä**: `wss://stream.binance.com:9443/stream?streams=btcusdt@kline_1s/ethusdt@kline_1s/ltcusdt@kline_1s`
- **–°–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `aiohttp.ClientSession.ws_connect()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `heartbeat=25`
- **Heartbeat**: 25 —Å–µ–∫—É–Ω–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ping/pong —á–µ—Ä–µ–∑ aiohttp)
- **–õ–∏–º–∏—Ç**: –î–æ **150 —Å—Ç—Ä–∏–º–æ–≤** –Ω–∞ –æ–¥–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø–∞—Å –Ω–∏–∂–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞ ~200)
- **–§—É–Ω–∫—Ü–∏—è**: `_ws_connection_worker()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è Spot

#### Futures (Linear) –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **Endpoint**: `wss://fstream.binance.com/ws` (–ø–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ JSON)
- **–§–æ—Ä–º–∞—Ç**: Continuous Kline stream –¥–ª—è –ø–µ—Ä–ø–µ—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- **–°–ø–æ—Å–æ–± –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `aiohttp.ClientSession.ws_connect()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `heartbeat=25`
- **Heartbeat**: 25 —Å–µ–∫—É–Ω–¥ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ping/pong —á–µ—Ä–µ–∑ aiohttp)
- **–õ–∏–º–∏—Ç**: –î–æ **150 —Å—Ç—Ä–∏–º–æ–≤** –Ω–∞ –æ–¥–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- **–§—É–Ω–∫—Ü–∏—è**: `_ws_connection_worker_subscribe()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è Linear

### Ping/Pong –º–µ—Ö–∞–Ω–∏–∑–º

Binance –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π heartbeat** —á–µ—Ä–µ–∑ aiohttp:
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: 25 —Å–µ–∫—É–Ω–¥
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –ü–∞—Ä–∞–º–µ—Ç—Ä `heartbeat=25` –≤ `ws_connect()`
- **–û–±—Ä–∞–±–æ—Ç–∫–∞**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ping/pong —Ñ—Ä–µ–π–º–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π aiohttp
- **–¢–∞–π–º–∞—É—Ç**: –ù–µ—Ç —è–≤–Ω–æ–≥–æ —Ç–∞–π–º–∞—É—Ç–∞, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

```python
async with _session.ws_connect(url, heartbeat=25) as ws:
    # aiohttp –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ping –∫–∞–∂–¥—ã–µ 25 —Å–µ–∫—É–Ω–¥
    # –∏ –æ–∂–∏–¥–∞–µ—Ç pong –æ—Ç–≤–µ—Ç
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª—ã

#### Spot - –ü–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–ú–µ—Ç–æ–¥**: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø—Ä—è–º–æ –≤ URL –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

**–§–æ—Ä–º–∞—Ç streams –≤ URL**:
```
wss://stream.binance.com:9443/stream?streams=symbol1@kline_1s/symbol2@kline_1s/...
```

**–ü—Ä–∏–º–µ—Ä —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è**:
```python
spot_streams = [f"{sym.lower()}@kline_1s" for sym in spot_symbols]
url = f"{SPOT_WS_ENDPOINT}?streams={'/'.join(chunk)}"
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –í—Å–µ —Å—Ç—Ä–∏–º—ã –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ü—Ä–æ—â–µ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### Linear - –ü–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ JSON —Å–æ–æ–±—â–µ–Ω–∏–µ

**–ú–µ—Ç–æ–¥**: –ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è JSON —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π

**–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏**:
```json
{
  "method": "SUBSCRIBE",
  "params": [
    "btcusdt_perpetual@continuousKline_1s",
    "ethusdt_perpetual@continuousKline_1s"
  ],
  "id": 1
}
```

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞**:
```python
subscribe_msg = {
    "method": "SUBSCRIBE",
    "params": streams,
    "id": 1
}
await ws.send_json(subscribe_msg)
```

**–§–æ—Ä–º–∞—Ç streams –¥–ª—è Linear**:
- –ö–∞–∂–¥—ã–π stream: `{symbol}_perpetual@continuousKline_1s`
- –ü—Ä–∏–º–µ—Ä: `btcusdt_perpetual@continuousKline_1s`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–¥–ø–∏—Å–∫–∏**:

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–µ—á–µ–Ω–∏–µ **30 —Å–µ–∫—É–Ω–¥**:

1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏** (JSON –æ—Ç–≤–µ—Ç —Å `id: 1`):
```json
{
  "result": null,
  "id": 1
}
```

2. **–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏** (JSON –æ—Ç–≤–µ—Ç —Å `id: 1` –∏ `error`):
```json
{
  "error": {
    "code": 400,
    "msg": "Invalid request"
  },
  "id": 1
}
```

3. **–î–∞–Ω–Ω—ã–µ continuous_kline** (–µ—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å—Ä–∞–∑—É –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):
```json
{
  "e": "continuous_kline",
  "E": 123456789,
  "ps": "BTCUSDT",
  "ct": "PERPETUAL",
  "k": { ... }
}
```

**–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
- –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (`result: null`) ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ ‚Üí –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ `continuous_kline` ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—é—â–µ–π
- –ï—Å–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥ –Ω–µ—Ç –Ω–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, –Ω–∏ –¥–∞–Ω–Ω—ã—Ö ‚Üí –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É
if payload.get("id") == 1:
    if payload.get("result") is None:
        # –û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏
        error_msg = payload.get("error", {}).get("msg", "Unknown error")
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    else:
        # –ü–æ–¥–ø–∏—Å–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
        subscription_confirmed = True

# –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
if payload.get("e") == "continuous_kline":
    # –ü–æ–¥–ø–∏—Å–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
    subscription_confirmed = True
    first_data_received = True
```

### –û—Ç–ø–∏—Å–∫–∞ –æ—Ç –∫–∞–Ω–∞–ª–æ–≤

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: –Ø–≤–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ **–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**

**–ü—Ä–∏—á–∏–Ω–∞**: 
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `task.cancel()` –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–∞—è –æ—Ç–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º**:
```python
# –î–ª—è Spot: –∑–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
# –î–ª—è Linear: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å UNSUBSCRIBE
unsubscribe_msg = {
    "method": "UNSUBSCRIBE",
    "params": streams,
    "id": 2
}
await ws.send_json(unsubscribe_msg)
```

### –ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏**: –°–æ–∑–¥–∞—ë—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è `aiohttp.ClientSession` –¥–ª—è –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤**: –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã —á–µ—Ä–µ–∑ REST API (`exchangeInfo`)
3. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤**:
   - –î–ª—è Spot –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–∞—Ä—ã —Å –∫–æ—Ç–∏—Ä—É–µ–º—ã–º–∏ –∞–∫—Ç–∏–≤–∞–º–∏: BTC, ETH, USDT, BNB, AUD, TUSD, BRL, GBP, USDC, TRX, EUR, BIDR, DOGE, TRY, FDUSD, AEUR
   - –î–ª—è Futures –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ PERPETUAL –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Å –∫–æ—Ç–∏—Ä—É–µ–º—ã–º–∏: USDT, USDC, BTC
4. **–†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞–Ω–∫–∏**: –ü–æ—Ç–æ–∫–∏ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏ –ø–æ 150 —Å—Ç—Ä–∏–º–æ–≤ –∫–∞–∂–¥—ã–π —Ñ—É–Ω–∫—Ü–∏–µ–π `_chunk_list()`
5. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è asyncio –∑–∞–¥–∞—á–∞ —á–µ—Ä–µ–∑ `asyncio.create_task()`
6. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –í—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ asyncio
7. **–ü–æ–¥–ø–∏—Å–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è Linear)**: 
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è JSON —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞–π–º–∞—É—Ç–∞ (30 —Å–µ–∫—É–Ω–¥)
   - –ï—Å–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞ –Ω–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö ‚Üí –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
8. **–†–µ–∫–æ–Ω–Ω–µ–∫—Ç**: –ü—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff

### –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞**:
```python
reconnect_attempt += 1
delay = min(2 ** min(reconnect_attempt - 1, 5), 60)
await asyncio.sleep(delay)
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: 2 —Å–µ–∫—É–Ω–¥—ã (–ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: 60 —Å–µ–∫—É–Ω–¥
- **–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç**: 2^(attempt-1), –Ω–æ –Ω–µ –±–æ–ª–µ–µ 5 —Å—Ç–µ–ø–µ–Ω–∏ (–º–∞–∫—Å–∏–º—É–º 32 —Å–µ–∫—É–Ω–¥—ã, –∑–∞—Ç–µ–º 60)
- **–°—á—ë—Ç—á–∏–∫**: –ö–∞–∂–¥—ã–π —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ `_stats[market]["reconnects"]`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `logger.error()`
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è callback `on_error()` —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏
- –¶–∏–∫–ª –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –¥–æ —è–≤–Ω–æ–π –æ—Ç–º–µ–Ω—ã –∑–∞–¥–∞—á–∏

## üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–µ—á–µ–π

### Spot
- **–¢–∏–ø —Å—Ç—Ä–∏–º–∞**: `@kline_1s` (1-—Å–µ–∫—É–Ω–¥–Ω—ã–µ —Å–≤–µ—á–∏)
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è**: —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏ (–ø–æ–ª–µ `x: true`)
- **–ò—Å—Ç–æ—á–Ω–∏–∫**: –≥–æ—Ç–æ–≤—ã–µ —Å–≤–µ—á–∏ –æ—Ç Binance API

### Futures (Linear)
- **–¢–∏–ø —Å—Ç—Ä–∏–º–∞**: `continuousKline_1s` –¥–ª—è –ø–µ—Ä–ø–µ—Ç—É–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- **–§–æ—Ä–º–∞—Ç**: `{pair}_perpetual@continuousKline_1s` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `btcusdt_perpetual@continuousKline_1s`)
- **–°–æ–±—ã—Ç–∏–µ**: `continuous_kline` (–Ω–µ –æ–±—ã—á–Ω—ã–π `kline`)
- **–°–∏–º–≤–æ–ª**: –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–æ–ª—è `ps` (–Ω–µ `s`)
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è**: —Ç–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—ã–µ —Å–≤–µ—á–∏ (–ø–æ–ª–µ `x: true`)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–≤–µ—á–∏
```json
{
  "o": "50000",  // Open (—Ü–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è)
  "h": "51000",  // High (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞)
  "l": "49000",  // Low (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞)
  "c": "50500",  // Close (—Ü–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è)
  "q": "1000.5", // Quote Volume (–æ–±—ä—ë–º –≤ –∫–æ—Ç–∏—Ä—É–µ–º–æ–º –∞–∫—Ç–∏–≤–µ)
  "x": true      // Is Closed (—Ñ–ª–∞–≥ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–≤–µ—á–∏)
}
```

## üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- **–ó–∞–¥–µ—Ä–∂–∫–∞**: —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff –æ—Ç 2 –¥–æ 60 —Å–µ–∫—É–Ω–¥
- **–°—á—ë—Ç—á–∏–∫**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞

## üìà –ö–æ—Ç–∏—Ä—É–µ–º—ã–µ –∞–∫—Ç–∏–≤—ã

### Spot —Ä—ã–Ω–æ–∫
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ—Ç–∏—Ä—É–µ–º—ã–µ –∞–∫—Ç–∏–≤—ã: `BTC`, `ETH`, `USDT`, `BNB`, `AUD`, `TUSD`, `BRL`, `GBP`, `USDC`, `TRX`, `EUR`, `BIDR`, `DOGE`, `TRY`, `FDUSD`, `AEUR`

### Futures —Ä—ã–Ω–æ–∫
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ—Ç–∏—Ä—É–µ–º—ã–µ –∞–∫—Ç–∏–≤—ã: `USDT`, `USDC`, `BTC`

–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –æ–±—ä—ë–º–æ–≤:
- –î–ª—è USD-—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –º–æ–Ω–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 1.0
- –î—Ä—É–≥–∏–µ –∞–∫—Ç–∏–≤—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ –∫—É—Ä—Å—É

## ‚öôÔ∏è –õ–∏–º–∏—Ç—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ª–∏–º–∏—Ç—ã

#### –õ–∏–º–∏—Ç—ã –≤ –∫–æ–¥–µ
- **–°—Ç—Ä–∏–º–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (Spot)**: **150** (`STREAMS_PER_CONNECTION = 150`)
- **–°—Ç—Ä–∏–º–æ–≤ –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (Linear)**: **150** (`STREAMS_PER_CONNECTION = 150`)
- **Heartbeat –∏–Ω—Ç–µ—Ä–≤–∞–ª**: **25 —Å–µ–∫—É–Ω–¥**
- **–¢–∞–π–º–∞—É—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ (Linear)**: **30 —Å–µ–∫—É–Ω–¥** (`subscription_timeout = 30.0`)
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞**: **60 —Å–µ–∫—É–Ω–¥**

#### –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã Binance
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç —Å—Ç—Ä–∏–º–æ–≤**: ~200 –Ω–∞ –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ–º 150 –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (25% –∑–∞–ø–∞—Å)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

‚ö†Ô∏è **–í–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å**:
- –ù–µ –ø—Ä–µ–≤—ã—à–∞–π—Ç–µ 150 —Å—Ç—Ä–∏–º–æ–≤ –Ω–∞ –æ–¥–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–∏–º–≤–æ–ª–æ–≤ —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ `get_statistics()`

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```python
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
num_connections = ceil(total_symbols / 150)
```

**–ü—Ä–∏–º–µ—Ä**:
- 250 —Å–∏–º–≤–æ–ª–æ–≤ Spot ‚Üí 2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (150 + 100)
- 180 —Å–∏–º–≤–æ–ª–æ–≤ Linear ‚Üí 2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (150 + 30)

## üìù –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **REST API**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ `exchangeInfo`
2. **–ú—É–ª—å—Ç–∏-—Å—Ç—Ä–∏–º**: –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –æ–¥–Ω–æ–º WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –¥–ª—è Spot
3. **JSON –ø–æ–¥–ø–∏—Å–∫–∞**: –Ø–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ JSON –¥–ª—è Futures
4. **Parallel processing**: –í—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ asyncio
5. **Memory efficient**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ç–æ–≤—ã—Ö —Å–≤–µ—á–µ–π –±–µ–∑ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏

## üõ†Ô∏è API Endpoints

- **REST Spot Info**: `https://api.binance.com/api/v3/exchangeInfo`
- **REST Futures Info**: `https://fapi.binance.com/fapi/v1/exchangeInfo`
- **WS Spot**: `wss://stream.binance.com:9443/stream`
- **WS Futures**: `wss://fstream.binance.com/ws`
- **WS Futures Stream**: `wss://fstream.binance.com/stream`

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```python
from exchanges.binance import ws_handler

stats = ws_handler.get_statistics()
print(f"Spot connections: {stats['spot']['active_connections']}")
print(f"Linear connections: {stats['linear']['active_connections']}")
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–º–≤–æ–ª–æ–≤
–°–ø–∏—Å–æ–∫ —Å–∏–º–≤–æ–ª–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö:
```
Binance spot: –∑–∞–ø—É—â–µ–Ω–æ 2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è 250 —Å–∏–º–≤–æ–ª–æ–≤
Binance linear: –∑–∞–ø—É—â–µ–Ω–æ 2 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è 180 —Å–∏–º–≤–æ–ª–æ–≤
```
