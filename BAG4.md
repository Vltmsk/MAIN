# Bug 4: –°–∫—Ä—ã—Ç–∏–µ –±–∞–∑–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —Å–ø–∏—Å–∫–µ —É—Å–ª–æ–≤–∏–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–í `StrategyDetailsPanel.tsx:612-616` —É—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –≤—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏–∑ —Å–ø–∏—Å–∫–∞ —É—Å–ª–æ–≤–∏–π (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `null`), –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è `useGlobalFilters`.

```typescript
{strategy.conditions
  .map((condition, actualIndex) => {
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–æ–±—ä—ë–º, –¥–µ–ª—å—Ç–∞, —Ç–µ–Ω—å) - –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–µ–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    if (condition.type === "delta" || condition.type === "volume" || condition.type === "wick_pct") {
      return null;
    }
    // ...
  })
}
```

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

- **–ö–æ–≥–¥–∞ `useGlobalFilters = false`**: –£—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –≤ —Å–µ–∫—Ü–∏–∏ –±–∞–∑–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–Ω–µ –≤ —Å–ø–∏—Å–∫–µ —É—Å–ª–æ–≤–∏–π) ‚Äî **—ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**.

- **–ö–æ–≥–¥–∞ `useGlobalFilters = true`**: –£—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –º–∞—Å—Å–∏–≤–µ `conditions`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ï—Å–ª–∏ –æ–Ω–∏ —Å–ª—É—á–∞–π–Ω–æ –ø–æ–ø–∞–¥—É—Ç –≤ –º–∞—Å—Å–∏–≤ (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, API), –æ–Ω–∏ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã –≤ UI, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É.

## –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ `useGlobalFilters = true`** (—Å—Ç—Ä–æ–∫–∞ 329-330):
   - –£—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –º–∞—Å—Å–∏–≤–∞ `conditions`
   ```typescript
   const updatedConditions = useGlobalFilters
     ? strategy.conditions.filter(
         (c) => c.type !== "delta" && c.type !== "volume" && c.type !== "wick_pct"
       )
     : strategy.conditions;
   ```

2. **–í backend** (`spike_detector.py:927-930`):
   - –ü—Ä–∏ `useGlobalFilters = true` —ç—Ç–∏ —É—Å–ª–æ–≤–∏—è –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
   ```python
   if use_global_filters:
       cond_type = condition.get("type")
       if cond_type in ("delta", "volume", "wick_pct"):
           continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
   ```

3. **–í UI** (—Å—Ç—Ä–æ–∫–∞ 612-616):
   - –í—Å–µ —É—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏–∑ —Å–ø–∏—Å–∫–∞ —É—Å–ª–æ–≤–∏–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç `useGlobalFilters`

### –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

- ‚úÖ **–î–ª—è `useGlobalFilters = false`**: –ë–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 360-578), —Å–∫—Ä—ã—Ç–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —É—Å–ª–æ–≤–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

- ‚úÖ **–î–ª—è `useGlobalFilters = true`**: –ë–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫, –æ–Ω–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –º–∞—Å—Å–∏–≤–µ `conditions`, –∏ —Å–∫—Ä—ã—Ç–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —É—Å–ª–æ–≤–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ï—Å–ª–∏ –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å `useGlobalFilters = true` –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ (—Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API, –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏) –æ—Å—Ç–∞–ª–∏—Å—å —É—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –≤ –º–∞—Å—Å–∏–≤–µ `conditions`, –æ–Ω–∏ –±—É–¥—É—Ç:

1. **–°–∫—Ä—ã—Ç—ã –≤ UI** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Ö –Ω–µ —É–≤–∏–¥–∏—Ç
2. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ backend** ‚Äî –Ω–µ –±—É–¥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
3. **–ó–∞–Ω–∏–º–∞—Ç—å –º–µ—Å—Ç–æ –≤ –º–∞—Å—Å–∏–≤–µ** ‚Äî –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ë–î, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

–≠—Ç–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ –∏–ª–∏ –∞–Ω–∞–ª–∏–∑–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.

## –õ–æ–≥–∏–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

> –ü–æ –∏–¥–µ–µ –º–æ–µ–π –∫–∞–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, –µ—Å–ª–∏ `useGlobalFilters = true` –∏ –∫ –ø—Ä–∏–º–µ—Ä—É –≤ —É—Å–ª–æ–≤–∏–∏ —Å—Ç–æ–∏—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö, —Ç–æ —ç—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–π –±–∏—Ä–∂–µ –≥–¥–µ –±—É–¥–µ—Ç —Å—Ç—Ä–µ–ª–∞ –≤–≤–µ—Ä—Ö —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç—Ç–æ–π –±–∏—Ä–∂–∏.

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ:
- –ü—Ä–∏ `useGlobalFilters = true`: –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (delta, volume, wick_pct) –±–µ—Ä—É—Ç—Å—è –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–π –±–∏—Ä–∂–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (direction, symbol, exchange_market, series) –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏–∑ –º–∞—Å—Å–∏–≤–∞ `conditions`
- –£—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –≤ –º–∞—Å—Å–∏–≤–µ `conditions` –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç

- **–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏**: –ù–∏–∑–∫–∏–π
- **–¢–∏–ø –ø—Ä–æ–±–ª–µ–º—ã**: Edge case / UX –ø—Ä–æ–±–ª–µ–º–∞
- **–í–ª–∏—è–Ω–∏–µ**: 
  - –í –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  - –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ "–º—É—Å–æ—Ä–Ω—ã—Ö" –¥–∞–Ω–Ω—ã—Ö –≤ –º–∞—Å—Å–∏–≤–µ `conditions`
  - –£—Å–ª–æ–∂–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤. –ü—Ä–æ–±–ª–µ–º–∞ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –æ—á–∏—Å—Ç–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å `useGlobalFilters = true` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å —É—Å–ª–æ–≤–∏—è `delta`, `volume`, `wick_pct` –∏–∑ –º–∞—Å—Å–∏–≤–∞ `conditions`:

```typescript
// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
if (strategy.useGlobalFilters !== false) {
  strategy.conditions = strategy.conditions.filter(
    (c) => c.type !== "delta" && c.type !== "volume" && c.type !== "wick_pct"
  );
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ UI, –µ—Å–ª–∏ –ø—Ä–∏ `useGlobalFilters = true` –≤ –º–∞—Å—Å–∏–≤–µ `conditions` –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:

```typescript
const hasBaseFilters = strategy.conditions.some(
  (c) => c.type === "delta" || c.type === "volume" || c.type === "wick_pct"
);

{strategy.useGlobalFilters !== false && hasBaseFilters && (
  <div className="warning">
    –í —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã. 
    –û–Ω–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω—ã –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.
  </div>
)}
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `WEB/app/(dashboard)/components/SettingsTab/StrategyDetailsPanel.tsx` (—Å—Ç—Ä–æ–∫–∏ 329-330, 612-616)
- `core/spike_detector.py` (—Å—Ç—Ä–æ–∫–∏ 927-930)

## –°—Ç–∞—Ç—É—Å

üü° **–ß–∞—Å—Ç–∏—á–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö, –Ω–æ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—É—Ç–∞–Ω–∏—Ü—É –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

